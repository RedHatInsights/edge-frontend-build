{"version":3,"sources":["webpack:///./src/Routes/ImageManager/UpdateImageWizard.js"],"names":["UpdateImage","navigateBack","updateImageID","useState","user","setUser","dispatch","useDispatch","updateRepoURL","setUpdateRepoURL","closeAction","type","CREATE_NEW_IMAGE_RESET","getRegistry","useContext","RegistryContext","data","useSelector","imageDetailReducer","shallowEqual","useEffect","registered","register","loadImageDetail","insights","chrome","auth","getUser","userData","imageUpdateRepoURL","found","onClose","customComponentMapper","review","ReviewStep","onSubmit","values","payload","name","Name","version","Version","architecture","oSTreeParentCommit","credentials","Installer","SshKey","username","Username","createNewImage","addImageToPoll","value","id","ID","defaultArch","initialValues","isUpdate","description","Description","imageType","Commit","Packages","map","pkg","schema","fields","component","componentTypes","className","isDynamic","inModal","buttonLabels","submit","showTitles","title","crossroads","updateDetails","imageOutput","registration","packages","propTypes","PropTypes","defaultProps"],"mappings":"+9BAsBA,IAAMA,EAAc,SAAC,GAAoC,MAAlCC,EAAkC,EAAlCA,aAAcC,EAAoB,EAApBA,cAAoB,GAC/BC,gBAD+B,WAChDC,EADgD,KAC1CC,EAD0C,KAEjDC,GAAWC,mBAFsC,GAGbJ,cAAS,IAHI,WAGhDK,EAHgD,KAGjCC,EAHiC,KAIjDC,EAAc,WAClBT,IACAK,EAAS,CAAEK,KAAMC,OAGXC,GAAgBC,gBAAWC,KAA3BF,YACAG,GAASC,kBACf,gBAAGC,EAAH,EAAGA,mBAAH,MAA6B,CAAEF,MAAME,aAAA,EAAAA,EAAoBF,OAAQ,QACjEG,gBAFMH,KAwBR,OAnBAI,gBAAU,WACR,IAAMC,EAAaR,IAAcS,SAAS,CACxCJ,0BAGF,OADAK,QAAgBjB,EAAUJ,GACnB,kBAAMmB,OACZ,CAACf,KAEJc,gBAAU,WACR,cAAC,oHACyBI,gBADzB,iBACyB,EAAUC,cADnC,iBACyB,EAAkBC,YAD3C,aACyB,EAAwBC,UADjD,gDAC+D,GAD/D,OACOC,EADP,KAECvB,GAAQ,kBAAMuB,KAFf,0CAAD,GAIA,cAAC,qGACqBC,QAAmB3B,GADxC,OACO4B,EADP,OAECrB,EAAiBqB,GAFlB,0CAAD,KAIC,IAEI1B,EACL,kBAAC,IAAD,CACE2B,QAASrB,EACTsB,sBAAuB,CACrBC,OAAQC,KAEVC,SAAU,SAACC,GACT,IAAMC,EAAU,EAAH,KACRD,GADQ,IAEXE,KAAMtB,aAAF,EAAEA,EAAMuB,KACZC,SAASxB,aAAA,EAAAA,EAAMyB,SAAU,EACzBC,aAAc,SACdC,mBAAoBnC,EACpBoC,YAAaR,EAAOQ,YAChBR,EAAOQ,YACP5B,aAFS,EAETA,EAAM6B,UAAUC,OACpBC,SAAUX,EAAOW,SACbX,EAAOW,SACP/B,aAFM,EAENA,EAAM6B,UAAUG,YAEtBC,QAAe3C,EAAU+B,GAAS,SAACrB,GACjCN,IACAJ,GACE4C,QAAe,CAAEZ,KAAMtB,EAAKmC,MAAMZ,KAAMa,GAAIpC,EAAKmC,MAAME,UAI7DC,YAAY,SACZC,cAAe,CACbjB,KAAMtB,aAAF,EAAEA,EAAMuB,KACZiB,UAAU,EACVC,YAAazC,aAAF,EAAEA,EAAM0C,YACnBd,YAAa5B,aAAF,EAAEA,EAAM6B,UAAUC,OAC7BC,SAAU/B,aAAF,EAAEA,EAAM6B,UAAUG,SAC1BR,QAASxB,aAAF,EAAEA,EAAMyB,QACfkB,UAAW,CAAC,oBACZ,oBAAqB3C,SAArB,UAAqBA,EAAM4C,cAA3B,aAAqB,EAAcC,SAASC,KAAI,SAACC,GAAD,cAC3CA,GAD2C,IAE9CzB,KAAMyB,EAAIxB,WAGdyB,OAAQ,CACNC,OAAQ,CACN,CACEC,UAAWC,WACX7B,KAAM,uBACN8B,UAAW,gBACXC,WAAW,EACXC,SAAS,EACTC,aAAc,CACZC,OAAQ,iBAEVC,YAAY,EACZC,MAAO,iBAAF,OAAmB1D,aAAnB,EAAmBA,EAAMuB,MAC9BoC,WAAY,CAAC,qBAAsB,UAAW,aAG9CV,OAAQ,CACNW,KACAC,KACAC,KACAC,KACA9C,WAOV,kBAAC,IAAD,OAIJjC,EAAYgF,UAAY,CACtB/E,aAAcgF,SACd/E,cAAe+E,YAEjBjF,EAAYkF,aAAe,CACzBjF,aAAc,cAGhB","file":"js/UpdateImageWizard.f21b786e4aedd21d8ea8.js","sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\nimport ImageCreator from '../../components/ImageCreator';\nimport componentTypes from '@data-driven-forms/react-form-renderer/component-types';\nimport {\n  review,\n  packages,\n  updateDetails,\n  registration,\n  imageOutput,\n} from './steps';\nimport { Spinner } from '@patternfly/react-core';\nimport PropTypes from 'prop-types';\nimport ReviewStep from '../../components/form/ReviewStep';\nimport { createNewImage, addImageToPoll } from '../../store/actions';\nimport { CREATE_NEW_IMAGE_RESET } from '../../store/action-types';\nimport { useDispatch } from 'react-redux';\nimport { useSelector, shallowEqual } from 'react-redux';\nimport { RegistryContext } from '../../store';\nimport { imageDetailReducer } from '../../store/reducers';\nimport { loadImageDetail } from '../../store/actions';\nimport { imageUpdateRepoURL } from '../../api/index';\n\nconst UpdateImage = ({ navigateBack, updateImageID }) => {\n  const [user, setUser] = useState();\n  const dispatch = useDispatch();\n  const [updateRepoURL, setUpdateRepoURL] = useState('');\n  const closeAction = () => {\n    navigateBack();\n    dispatch({ type: CREATE_NEW_IMAGE_RESET });\n  };\n\n  const { getRegistry } = useContext(RegistryContext);\n  const { data } = useSelector(\n    ({ imageDetailReducer }) => ({ data: imageDetailReducer?.data || null }),\n    shallowEqual\n  );\n\n  useEffect(() => {\n    const registered = getRegistry().register({\n      imageDetailReducer,\n    });\n    loadImageDetail(dispatch, updateImageID);\n    return () => registered();\n  }, [dispatch]);\n\n  useEffect(() => {\n    (async () => {\n      const userData = (await insights?.chrome?.auth?.getUser()) || {};\n      setUser(() => userData);\n    })();\n    (async () => {\n      const found = await imageUpdateRepoURL(updateImageID);\n      setUpdateRepoURL(found);\n    })();\n  }, []);\n\n  return user ? (\n    <ImageCreator\n      onClose={closeAction}\n      customComponentMapper={{\n        review: ReviewStep,\n      }}\n      onSubmit={(values) => {\n        const payload = {\n          ...values,\n          name: data?.Name,\n          version: data?.Version + 1,\n          architecture: 'x86_64',\n          oSTreeParentCommit: updateRepoURL,\n          credentials: values.credentials\n            ? values.credentials\n            : data?.Installer.SshKey,\n          username: values.username\n            ? values.username\n            : data?.Installer.Username,\n        };\n        createNewImage(dispatch, payload, (data) => {\n          closeAction();\n          dispatch(\n            addImageToPoll({ name: data.value.Name, id: data.value.ID })\n          );\n        });\n      }}\n      defaultArch=\"x86_64\"\n      initialValues={{\n        name: data?.Name,\n        isUpdate: true,\n        description: data?.Description,\n        credentials: data?.Installer.SshKey,\n        username: data?.Installer.Username,\n        version: data?.Version,\n        imageType: ['rhel-edge-commit'],\n        'selected-packages': data?.Commit?.Packages.map((pkg) => ({\n          ...pkg,\n          name: pkg.Name,\n        })),\n      }}\n      schema={{\n        fields: [\n          {\n            component: componentTypes.WIZARD,\n            name: 'image-builder-wizard',\n            className: 'image-builder',\n            isDynamic: true,\n            inModal: true,\n            buttonLabels: {\n              submit: 'Create update',\n            },\n            showTitles: true,\n            title: `Update image: ${data?.Name}`,\n            crossroads: ['target-environment', 'release', 'imageType'],\n            // order in this array does not reflect order in wizard nav, this order is managed inside\n            // of each step by `nextStep` property!\n            fields: [\n              updateDetails,\n              imageOutput,\n              registration,\n              packages,\n              review,\n            ],\n          },\n        ],\n      }}\n    />\n  ) : (\n    <Spinner />\n  );\n};\n\nUpdateImage.propTypes = {\n  navigateBack: PropTypes.func,\n  updateImageID: PropTypes.number,\n};\nUpdateImage.defaultProps = {\n  navigateBack: () => undefined,\n};\n\nexport default UpdateImage;\n"],"sourceRoot":""}