"use strict";(self.webpackChunkinsights_frontend_starter_app=self.webpackChunkinsights_frontend_starter_app||[]).push([[46],{53010:(e,n,t)=>{t.r(n),t.d(n,{default:()=>_});var a=t(4942),i=t(15861),r=t(29439),l=t(87757),u=t.n(l),o=t(93264),s=t.n(o),c=t(67098),d=t(96354),m=t(1005),v=t(2372),f=t(45697),g=t.n(f),p=t(20873),b=t(94778),h=t(59086),y=t(82041),I=t(59245),D=t(24672),w=t(66702),O=t(83215);function j(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function E(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?j(Object(t),!0).forEach((function(n){(0,a.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):j(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var N=function(e){var n,t,a,l,f,g,j,N,_=e.navigateBack,k=e.updateImageID,S=(0,o.useState)(),P=(0,r.Z)(S,2),U=P[0],Z=P[1],C=(0,y.useDispatch)(),R=function(){_(),C({type:h.G})},T=(0,o.useContext)(I.g).getRegistry,x=(0,y.useSelector)((function(e){var n=e.imageDetailReducer;return{data:(null==n?void 0:n.data)||null}}),y.shallowEqual).data;return(0,o.useEffect)((function(){var e=T().register({imageDetailReducer:D.OD});return k&&(0,b.J_)(C,k),function(){return e()}}),[C]),(0,o.useEffect)((function(){(0,i.Z)(u().mark((function e(){var n,t,a,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=insights)||void 0===n||null===(t=n.chrome)||void 0===t||null===(a=t.auth)||void 0===a?void 0:a.getUser();case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={};case 5:i=e.t0,Z((function(){return i}));case 7:case"end":return e.stop()}}),e)})))()}),[]),U?s().createElement(c.Z,{onClose:R,customComponentMapper:{review:p.Z},onSubmit:function(e){var n,t,a,i,r,l=e.values;(0,e.setIsSaving)((function(){return!0}));var u=E(E({},l),{},{Id:null==x||null===(n=x.image)||void 0===n?void 0:n.ID,name:null==x||null===(t=x.image)||void 0===t?void 0:t.Name,version:(null==x||null===(a=x.image)||void 0===a?void 0:a.Version)+1,architecture:"x86_64",credentials:l.credentials?l.credentials:null==x||null===(i=x.image)||void 0===i?void 0:i.Installer.SshKey,username:l.username?l.username:null==x||null===(r=x.image)||void 0===r?void 0:r.Installer.Username});(0,b.Es)(C,u,(function(e){C(E(E({},(0,O.wN)({variant:"info",title:"Update image",description:"".concat(e.value.Name," image was added to the queue.")})),{},{meta:{polling:{id:"FETCH_IMAGE_".concat(e.value.ID,"_BUILD_STATUS"),fetcher:function(){return(0,w.EC)(e.value.ID)},condition:function(e){switch(e.Status){case"BUILDING":return[!0,""];case"ERROR":return[!1,"failure"];default:return[!1,"success"]}},onEvent:{failure:[function(n){return n((0,O.wN)({variant:"danger",title:"Image build failed",description:"".concat(e.value.Name," image build is completed unsuccessfully")}))}],success:[function(n){return n((0,O.wN)({variant:"success",title:"Image is ready",description:"".concat(e.value.Name," image build is completed")}))},function(e){return(0,b.Z5)(e)}]}}}})),R(),(0,b.Z5)(C),C((0,b.Fj)({name:x.value.Name,id:x.value.ID}))}))},defaultArch:"x86_64",initialValues:{name:null==x||null===(n=x.image)||void 0===n?void 0:n.Name,isUpdate:!0,description:null==x||null===(t=x.image)||void 0===t?void 0:t.Description,credentials:null==x||null===(a=x.image)||void 0===a?void 0:a.Installer.SshKey,username:null==x||null===(l=x.image)||void 0===l?void 0:l.Installer.Username,version:null==x||null===(f=x.image)||void 0===f?void 0:f.Version,release:null==x||null===(g=x.image)||void 0===g?void 0:g.Distribution,imageType:["rhel-edge-commit"],"selected-packages":null==x||null===(j=x.image)||void 0===j?void 0:j.Packages.map((function(e){return E(E({},e),{},{name:e.Name})}))},schema:{fields:[{component:d.Z.WIZARD,name:"image-builder-wizard",className:"image-builder",isDynamic:!0,inModal:!0,buttonLabels:{submit:"Create image"},showTitles:!0,title:"Update image: ".concat(null==x||null===(N=x.image)||void 0===N?void 0:N.Name),crossroads:["target-environment","release","imageType"],fields:[m.bR,m.Ud,m.l9,m.B9,m.j7]}]}}):s().createElement(v.$,null)};N.propTypes={navigateBack:g().func,updateImageID:g().number},N.defaultProps={navigateBack:function(){}};const _=N}}]);
//# sourceMappingURL=../sourcemaps/UpdateImageWizard.bd6bf90377ee9f4c0adf4611373f0e9e.js.map