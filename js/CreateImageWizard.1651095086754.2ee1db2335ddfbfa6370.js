"use strict";(self.webpackChunkinsights_frontend_starter_app=self.webpackChunkinsights_frontend_starter_app||[]).push([[344,940],{68940:(e,t,n)=>{n.r(t),n.d(t,{default:()=>U});var a=n(4942),r=n(15861),i=n(29439),l=n(87757),o=n.n(l),c=n(75418),u=n.n(c),s=n(68774),d=n(68340),p=n(52643),m=n(29390),v=n(2372),f=n(69957),g=n(45697),b=n.n(g),h=n(66702),y=n(28216),O=n(83215),w=n(60722),E=n(96354),D=n(60485),j=n(78140),I=n(25834),P=function(e){var t=e.reviewObject,n=e.key;return u().createElement(s.D,null,u().createElement(D.D,{headingLevel:"h3"},u().createElement(d.x,{component:"b"},t.title)),u().createElement(I.G,{component:I.F.dl},t.rows.map((function(e){return u().createElement(c.Fragment,{key:e.title+n},u().createElement(j.T,{component:j.v.dt},e.title),u().createElement(j.T,{component:j.v.dd},e.value))}))))};P.propTypes={reviewObject:b().object,key:b().string};const T=P;var _=n(62410),k=n(68920);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Z=function(e){var t,n,a,l,g,b=e.updateModal,D=e.setUpdateModal,j=e.refreshTable,I=(0,c.useState)(null),P=(0,i.Z)(I,2),S=P[0],Z=P[1],U=(0,y.I0)(),C=b.deviceData.length>1,R=b.deviceData.map((function(e){return e.id})),x=C?b.deviceData.map((function(e){return e.display_name})):null==b||null===(t=b.deviceData[0])||void 0===t?void 0:t.display_name;null!=b&&b.imageSetId?(0,h.dt)({id:b.imageSetId}).then((function(e){return Z(e.Data.images[0])})):(g=b.imageId,(0,h.Kz)({id:g}).then((function(e){var t;return(0,h.dt)({id:null==e||null===(t=e.image)||void 0===t?void 0:t.ImageSetID})}))).then((function(e){return Z(e.Data.images[0])}));var A=function(){var e=(0,r.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,h.g5)({DevicesUUID:R});case 3:U(N({},(0,O.wN)({variant:"info",title:"Updating device",description:C?" ".concat(x.length," systems were added to the queue."):" ".concat(x," was added to the queue.")}))),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),U(N({},(0,O.wN)({variant:"danger",title:"Updating a device was unsuccessful",description:"Response: ".concat(e.t0.statusText)})));case 9:L(),j&&j();case 11:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),L=function(){D((function(e){return N(N({},e),{},{isOpen:!1})}))},M={title:"Update to version ".concat(null==S?void 0:S.image.Version),rows:[{title:"Image Name",value:null==S?void 0:S.image.Name},{title:"Version",value:null==S?void 0:S.image.Version},{title:"Created",value:u().createElement(_.Z,{date:null==S?void 0:S.image.CreatedAt})},{title:"Release",value:k.aN[null==S?void 0:S.image.Distribution]}]},q={title:"Changes from version ".concat((null==S?void 0:S.image.Version)-1),rows:[{title:"Added",value:(null==S||null===(n=S.update_added)||void 0===n?void 0:n.length)||0},{title:"Removed",value:(null==S||null===(a=S.update_removed)||void 0===a?void 0:a.length)||0},{title:"Updated",value:(null==S||null===(l=S.update_updated)||void 0===l?void 0:l.length)||0}]},V={fields:[{component:E.Z.PLAIN_TEXT,name:"description",label:u().createElement(s.D,null,u().createElement(d.x,null,"Update"," ",u().createElement("span",{className:"pf-u-font-weight-bold pf-u-font-size-md"},C?"".concat(x.length," systems"):x)," ","to latest version of the image linked to it."))},{component:E.Z.PLAIN_TEXT,name:"update-details",label:T({reviewObject:M,key:"update-details"})},{component:E.Z.PLAIN_TEXT,name:"package-details",label:T({reviewObject:q,key:"package-details"})},{component:E.Z.PLAIN_TEXT,name:"warning-text",label:u().createElement(s.D,{className:"pf-u-pt-md"},u().createElement(d.x,{style:{color:"var(--pf-global--palette--gold-500)"},component:"small"},u().createElement(f.ZP,null)," After the update is installed, the device will apply the changes."))}]};return u().createElement(u().Fragment,null,S?u().createElement(w.Z,{size:"medium",title:"Update system".concat(C?"s":""," to latest image version"),isOpen:b.isOpen,openModal:function(){return D((function(e){return N(N({},e),{},{isOpen:!1})}))},submitLabel:"Update Device",schema:V,onSubmit:A,reloadData:j}):u().createElement(m.Y,null,u().createElement(p.b,null,u().createElement(v.$,{isSVG:!0,diameter:"100px"}))))};Z.propTypes={refreshTable:b().func,updateModal:b().shape({isOpen:b().bool.isRequired,deviceData:b().array.isRequired,imageData:b().object,imageId:b().number,imageSetId:b().number}).isRequired,setUpdateModal:b().func.isRequired};const U=Z},49477:(e,t,n)=>{n.r(t),n.d(t,{default:()=>P});var a=n(4942),r=n(15861),i=n(29439),l=n(87757),o=n.n(l),c=n(75418),u=n.n(c),s=n(82951),d=n(96354),p=n(52251),m=n(2372),v=n(45697),f=n.n(v),g=n(20873),b=n(94778),h=n(59086),y=n(28216),O=n(83215),w=n(66702),E=n(58061);function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var I=function(e){var t=e.navigateBack,n=(0,c.useState)(),a=(0,i.Z)(n,2),l=a[0],v=a[1],f=(0,y.I0)(),D=(0,E.gV)("fleet-management.custom-repos"),I=function(){t(),f({type:h.G})};return(0,c.useEffect)((function(){(0,r.Z)(o().mark((function e(){var t,n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null===(t=insights)||void 0===t||null===(n=t.chrome)||void 0===n||null===(a=n.auth)||void 0===a||a.getUser().then((function(e){return v(null!=e?e:{})}));case 1:case"end":return e.stop()}}),e)})))()}),[]),l?u().createElement(s.Z,{onClose:I,customComponentMapper:{review:g.Z},onSubmit:function(e){var t=e.values;(0,e.setIsSaving)((function(){return!0}));var n=j(j({},t),{},{architecture:"x86_64"});(0,b.Es)(f,n,(function(e){f(j(j({},(0,O.wN)({variant:"info",title:"Created image",description:"".concat(e.value.Name," image was added to the queue.")})),{},{meta:{polling:{id:"FETCH_IMAGE_".concat(e.value.ID,"_BUILD_STATUS"),fetcher:function(){return(0,w.EC)(e.value.ID)},condition:function(e){switch(e.Status){case"BUILDING":return[!0,""];case"ERROR":return[!1,"failure"];default:return[!1,"success"]}},onEvent:{failure:[function(t){return t((0,O.wN)({variant:"danger",title:"Image build failed",description:"".concat(e.value.Name," image build is completed unsuccessfully")}))}],success:[function(t){return t((0,O.wN)({variant:"success",title:"Image is ready",description:"".concat(e.value.Name," image build is completed")}))},function(e){return(0,b.n9)(e)}]}}}})),(0,b.n9)(f),I()}))},defaultArch:"x86_64",initialValues:{version:0,includesCustomRepos:D},schema:{fields:[{component:d.Z.WIZARD,name:"image-builder-wizard",className:"image-builder",isDynamic:!0,inModal:!0,buttonLabels:{submit:"Create image"},showTitles:!0,title:"Create image",crossroads:["target-environment","release","imageType","third-party-repositories","imageOutput","imageSetDetails","includesCustomRepos"],fields:[p.oG,p.Ud,p.l9,p.jS,p.B9,p.j7,p.Sp]}]}}):u().createElement(m.$,null)};I.propTypes={navigateBack:f().func},I.defaultProps={navigateBack:function(){}};const P=I}}]);
//# sourceMappingURL=../sourcemaps/CreateImageWizard.fc9a520c4eb6827483114db94f7dfe8a.js.map