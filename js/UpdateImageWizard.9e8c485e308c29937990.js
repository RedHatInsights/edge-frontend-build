(self.webpackChunkinsights_frontend_starter_app=self.webpackChunkinsights_frontend_starter_app||[]).push([[46],{53010:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>P});var a=n(59713),r=n.n(a),i=n(87757),u=n.n(i),c=n(48926),s=n.n(c),o=n(63038),l=n.n(o),d=n(1427),m=n.n(d),f=n(10728),p=n(96354),v=n(31197),g=n(2372),b=n(45697),h=n.n(b),y=n(20873),O=n(94778),w=n(59086),D=n(80962),I=n(59245),j=n(96667),k=n(66702),E=n(65190);function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var S=function(e){var t,n=e.navigateBack,a=e.updateImageID,r=(0,d.useState)(),i=l()(r,2),c=i[0],o=i[1],b=(0,D.useDispatch)(),h=(0,d.useState)(""),N=l()(h,2),S=N[0],P=N[1],C=function(){n(),b({type:w.G})},U=(0,d.useContext)(I.g).getRegistry,x=(0,D.useSelector)((function(e){var t=e.imageDetailReducer;return{data:(null==t?void 0:t.data)||null}}),D.shallowEqual).data;return(0,d.useEffect)((function(){var e=U().register({imageDetailReducer:j.OD});return(0,O.J_)(b,a),function(){return e()}}),[b]),(0,d.useEffect)((function(){s()(u().mark((function e(){var t,n,a,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=insights)||void 0===t||null===(n=t.chrome)||void 0===n||null===(a=n.auth)||void 0===a?void 0:a.getUser();case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={};case 5:r=e.t0,o((function(){return r}));case 7:case"end":return e.stop()}}),e)})))(),s()(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,k.Gc)(a);case 2:t=e.sent,P(t);case 4:case"end":return e.stop()}}),e)})))()}),[]),c?m().createElement(f.Z,{onClose:C,customComponentMapper:{review:y.Z},onSubmit:function(e){var t=_(_({},e),{},{name:null==x?void 0:x.Name,version:(null==x?void 0:x.Version)+1,architecture:"x86_64",oSTreeParentCommit:S,credentials:e.credentials?e.credentials:null==x?void 0:x.Installer.SshKey,username:e.username?e.username:null==x?void 0:x.Installer.Username});(0,O.Es)(b,t,(function(e){b(_(_({},(0,E.addNotification)({variant:"info",title:"Update image",description:"".concat(e.value.Name," image was added to the queue.")})),{},{meta:{polling:{id:"FETCH_IMAGE_".concat(e.value.ID,"_BUILD_STATUS"),fetcher:function(){return(0,k.EC)(e.value.ID)},condition:function(e){switch(e.Status){case"BUILDING":return[!0,""];case"ERROR":return[!1,"failure"];default:return[!1,"success"]}},onEvent:{failure:[function(t){return t((0,E.addNotification)({variant:"danger",title:"Image build failed",description:"".concat(e.value.Name," image build is completed unsuccessfully")}))}],success:[function(t){return t((0,E.addNotification)({variant:"success",title:"Image is ready",description:"".concat(e.value.Name," image build is completed")}))},function(e){return(0,O.Z5)(e)}]}}}})),C(),b((0,O.Fj)({name:x.value.Name,id:x.value.ID})),(0,O.Z5)(b)}))},defaultArch:"x86_64",initialValues:{name:null==x?void 0:x.Name,isUpdate:!0,description:null==x?void 0:x.Description,credentials:null==x?void 0:x.Installer.SshKey,username:null==x?void 0:x.Installer.Username,version:null==x?void 0:x.Version,imageType:["rhel-edge-commit"],"selected-packages":null==x||null===(t=x.Commit)||void 0===t?void 0:t.Packages.map((function(e){return _(_({},e),{},{name:e.Name})}))},schema:{fields:[{component:p.Z.WIZARD,name:"image-builder-wizard",className:"image-builder",isDynamic:!0,inModal:!0,buttonLabels:{submit:"Create update"},showTitles:!0,title:"Update image: ".concat(null==x?void 0:x.Name),crossroads:["target-environment","release","imageType"],fields:[v.bR,v.Ud,v.l9,v.B9,v.j7]}]}}):m().createElement(g.$,null)};S.propTypes={navigateBack:h().func,updateImageID:h().number},S.defaultProps={navigateBack:function(){}};const P=S}}]);
//# sourceMappingURL=../sourcemaps/UpdateImageWizard.c7ad22168d5e2844ee44.js.map