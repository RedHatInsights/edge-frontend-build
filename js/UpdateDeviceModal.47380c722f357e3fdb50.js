(self.webpackChunkedge_frontend=self.webpackChunkedge_frontend||[]).push([[2941],{49629:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>x});var a=n(10467),r=n(5544),i=n(64467),o=n(54756),c=n.n(o),s=n(44914),u=n.n(s),l=n(51976),d=n(22069),p=n(55318),m=n(37623),v=n(932),f=n(89915),g=n(99851),b=n(5556),y=n.n(b),h=n(36513),O=n(29082),w=n(45321),E=n(11830),_=n(56899),j=n(57502),A=n(60316),D=n(90118),P=n(12921),k=function(e){var t=e.reviewObject,n=e.key;return u().createElement(l.n,null,u().createElement(A.h,{headingLevel:"h3"},u().createElement(d.E,{component:"b"},t.title)),u().createElement(P.K,{component:P.C.dl},t.rows.map((function(e){return u().createElement(s.Fragment,{key:e.title+n},u().createElement(D.L,{component:D.D.dt},e.title),u().createElement(D.L,{component:D.D.dd},e.value))}))))};k.propTypes={reviewObject:y().object,key:y().string};const I=k;var T=n(63767),S=n(51343),L=n(71100);function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var q=function(e){var t=e.inventoryGroupUpdateDevicesInfo,n=e.updateModal,i=e.setUpdateModal,o=e.refreshTable,b=e.notificationProp;if(!t||t.update_valid){var y,A,D=(0,s.useState)(null),P=(0,r.A)(D,2),k=P[0],M=P[1],q=(0,w.useDispatch)(),x=t?t.update_devices_uuids:n.deviceData.map((function(e){return e.id})),N=x.length>1;y=t?t.update_devices_uuids:N?n.deviceData.map((function(e){return e.display_name})):null==n||null===(A=n.deviceData[0])||void 0===A?void 0:A.display_name;var R=t?t.image_set_id:null==n?void 0:n.imageSetId;(0,s.useEffect)((function(){var e;R?(0,h.MH)({id:R,q:{limit:1,sort_by:"-created_at",status:"SUCCESS"}}).then((function(e){return M(e.Data.images[0])})):(e=n.imageId,(0,h.iI)({id:e}).then((function(e){var t;return(0,h.MH)({id:null==e||null===(t=e.image)||void 0===t?void 0:t.ImageSetID,q:{limit:1,sort_by:"-created_at"}})}))).then((function(e){return M(e.Data.images[0])}))}),[]);var C,V={onInfo:{title:"Updating system",description:N?" ".concat(y.length," systems were added to the queue."):" ".concat(y||"one system","  was added to the queue.")},onError:{title:"Error",description:"Failed to update the selected system(s)"}},z=function(){var e=(0,a.A)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,L.A)(q,(function(){return(0,O.Pn)({DevicesUUID:x})}),V,b);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),q(U({},(0,E.z8)({variant:"danger",title:"Updating a system was unsuccessful",description:"Response: ".concat(e.t0.statusText)})));case 8:F(),o&&o();case 10:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}(),F=function(){i((function(e){return U(U({},e),{},{isOpen:!1})}))},H={title:"Update to version ".concat(null==k?void 0:k.image.Version),rows:[{title:"Image Name",value:null==k?void 0:k.image.Name},{title:"Version",value:null==k?void 0:k.image.Version},{title:"Created",value:u().createElement(T.A,{date:null==k?void 0:k.image.CreatedAt})},{title:"Release",value:S.WT[null==k?void 0:k.image.Distribution]}]},X={title:"Changes from version ".concat((null==k?void 0:k.image.Version)-1),rows:[{title:"Added",value:(null==k?void 0:k.update_added)||0},{title:"Removed",value:(null==k?void 0:k.update_removed)||0},{title:"Updated",value:(null==k?void 0:k.update_updated)||0}]},G={fields:[{component:j.A.PLAIN_TEXT,name:"description",label:u().createElement(l.n,null,u().createElement(d.E,null,"Update"," ",u().createElement("span",{className:"pf-u-font-weight-bold pf-u-font-size-md"},N?"".concat(y.length," systems"):t||!y?"one system":y)," ","to latest version of the image linked to it."),(null==n||null===(C=n.deviceData)||void 0===C?void 0:C.some((function(e){return"updateAvailable"!==e.deviceStatus&&"error"!==e.deviceStatus})))&&u().createElement(f.F,{variant:"info",isInline:!0,title:"Some systems will not be updated. This action will update only systems with an update available.",style:{"--pf-c-content--h4--MarginTop":0}}))},{component:j.A.PLAIN_TEXT,name:"update-details",label:I({reviewObject:H,key:"update-details"})},{component:j.A.PLAIN_TEXT,name:"package-details",label:I({reviewObject:X,key:"package-details"})},{component:j.A.PLAIN_TEXT,name:"warning-text",label:u().createElement(l.n,{className:"pf-u-pt-md"},u().createElement(d.E,{style:{color:"var(--pf-global--warning-color--200"},component:"small"},u().createElement(g.Ay,{style:{color:"var(--pf-global--warning-color--100"}})," ","After the update is installed, the system will apply the changes."))}]};return u().createElement(u().Fragment,null,k?u().createElement(_.A,{size:"medium",title:"Update system".concat(N?"s":""," to latest image version"),isOpen:n.isOpen,closeModal:function(){return i((function(e){return U(U({},e),{},{isOpen:!1})}))},submitLabel:"Update system",schema:G,onSubmit:z,reloadData:o,notificationProp:b}):u().createElement(m.z,null,u().createElement(p.a,null,u().createElement(v.y,{diameter:"100px"}))))}i((function(e){return U(U({},e),{},{isOpen:!1})}))};q.propTypes={refreshTable:y().func,inventoryGroupUpdateDevicesInfo:y().shape({group_uuid:y().string,update_valid:y().bool,image_set_id:y().number,update_devices_uuids:y().array}),updateModal:y().shape({isOpen:y().bool.isRequired,deviceData:y().array.isRequired,imageData:y().object,imageId:y().number,imageSetId:y().number}).isRequired,setUpdateModal:y().func.isRequired,notificationProp:y().object};const x=q},36513:(e,t,n)=>{"use strict";n.d(t,{G9:()=>y,Ip:()=>m,J_:()=>v,MH:()=>p,Z5:()=>l,a7:()=>f,d6:()=>O,dW:()=>g,fw:()=>w,iI:()=>h,mF:()=>d,vy:()=>u,ze:()=>b});var a=n(10467),r=n(5544),i=n(54756),o=n.n(i),c=n(83986),s=n(56830),u=function(e){var t={name:e};return s.instance.post("".concat(c.rm,"/images/checkImageName"),t)},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.limit,n=void 0===t?10:t,a=e.offset,r=void 0===a?0:a;return s.instance.get("".concat(c.EH,"/activation_keys?limit=").concat(n,"&offset=").concat(r))},d=function(e){var t=e.Id,n=e.name,a=e.version,i=e.description,o=e.release,u=e.architecture,l=e.username,d=e.credentials,p=e.imageType,m=e["selected-packages"],v=e["third-party-repositories"],f=e["custom-packages"],g=e.activationKey,b=p||[],y=(0,r.A)(b,1)[0];p.length>1&&(y="rhel-edge-installer");var h={name:n,version:a,description:i,distribution:o,imageType:y,packages:null==m?void 0:m.map((function(e){return{name:e.name}})),outputTypes:p,commit:{arch:u},installer:{username:l,sshkey:d},thirdPartyRepositories:null==v?void 0:v.map((function(e){return{ID:e.id,Name:e.name,URL:e.URL,uuid:e.uuid}})),customPackages:null==f?void 0:f.map((function(e){return{Name:e.name}})),activationKey:g},O="".concat(c.rm,"/images");return a>1&&(O+="/".concat(t,"/update")),s.instance.post(O,h)},p=function(e){var t=e.id,n=e.q,a=void 0===n?{limit:10,offset:0,sort_by:"-created_at"}:n,r=(0,c.Lm)(a);return s.instance.get("".concat(c.rm,"/image-sets/").concat(t,"?").concat(r))},m=function(e){var t=e.imageSetID,n=e.query,a=void 0===n?{limit:20,offset:0,sort_by:"-created_at"}:n,r=(0,c.Lm)(a);return s.instance.get("".concat(c.rm,"/image-sets/view/").concat(t,"/versions?").concat(r))},v=function(e){var t=e.id;return s.instance.get("".concat(c.rm,"/image-sets/view/").concat(t))},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{limit:20,offset:0,sort_by:"-created_at"},t=(0,c.Lm)(e);return s.instance.get("".concat(c.rm,"/image-sets?").concat(t))},g=function(e){return s.instance.get("".concat(c.rm,"/images/").concat(e,"/status"))},b=function(e){return s.instance.get("".concat(c.rm,"/updates/device/").concat(e,"/image"))},y=function(){var e=(0,a.A)(o().mark((function e(t,n,a){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new URLSearchParams({distribution:t,architecture:n,search:a}),e.abrupt("return",(0,s.instance)("".concat(c.hE,"/packages?").concat(r.toString())));case 2:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),h=function(e){var t=e.id;return s.instance.get("".concat(c.rm,"/images/").concat(t,"/details"))},O=function(e){var t=e.query;""===t&&(t={limit:20,offset:0,sort_by:"-updated_at"});var n=(0,c.Lm)(t);return s.instance.get("".concat(c.rm,"/image-sets/view?").concat(n))},w=function(e,t){return s.instance.post("".concat(c.gT,"/rpms/names"),{urls:e,search:t})}},56899:(e,t,n)=>{"use strict";n.d(t,{A:()=>h});var a=n(10467),r=n(64467),i=n(58168),o=n(54756),c=n.n(o),s=n(44914),u=n.n(s),l=n(16165),d=n(97744),p=n(63537),m=n(24408),v=n(5556),f=n.n(v);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var y=function(e){var t=e.isOpen,n=e.title,r=e.titleIconVariant,o=e.closeModal,s=e.submitLabel,v=e.schema,f=e.initialValues,g=e.variant,y=e.reloadData,h=e.size,O=e.onSubmit,w=e.additionalMappers,E=e.validatorMapper;return u().createElement(l.a,{variant:null!=h?h:"small",title:n,titleIconVariant:null!=r?r:null,isOpen:t,onClose:o},u().createElement(d.A,{schema:v,validatorMapper:E,FormTemplate:function(e){return u().createElement(p.Ay,(0,i.A)({},e,{submitLabel:s,disableSubmit:["invalid"],buttonsProps:{submit:{variant:g}}}))},initialValues:f,componentMapper:w?b(b({},w),m.Ay):m.Ay,onSubmit:function(){var e=(0,a.A)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t);case 2:setTimeout((0,a.A)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),500),o();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onCancel:function(){return o()}}))};y.propTypes={isOpen:f().bool,title:f().string,closeModal:f().func,reloadData:f().func,submitLabel:f().string,schema:f().object,initialValues:f().object,variant:f().string,onSubmit:f().func,size:f().string,additionalMappers:f().object,titleIconVariant:f().any,validatorMapper:f().object};const h=y},25823:()=>{},16369:()=>{},62275:()=>{},89205:()=>{},20681:()=>{},43502:()=>{},61858:()=>{},43619:()=>{},92004:()=>{},74895:()=>{},7302:()=>{},63701:()=>{},71036:()=>{},8700:()=>{},98497:()=>{},5637:()=>{},86073:()=>{},67879:()=>{},28195:()=>{},98469:()=>{},21289:()=>{},36752:()=>{},85586:()=>{}}]);
//# sourceMappingURL=../sourcemaps/UpdateDeviceModal.aa5f0847f81583abacf0b9f4f015fe85.js.map